# Data Model: Navbar Logout Button Integration

**Feature**: 007-navbar-logout
**Date**: 2025-12-23
**Purpose**: Define data entities and their relationships for navbar authentication state management

## Overview

This feature is a **UI-only modification** with no new data entities or database schemas. All data models are inherited from the existing Better Auth integration via custom auth-client.ts.

The navbar component consumes existing authentication state and does not introduce new data structures.

## Existing Data Entities (Referenced, Not Modified)

### User

**Source**: `src/lib/auth-client.ts:13-21` and `src/components/auth/AuthContext.tsx:8-16`

**Purpose**: Represents an authenticated user's identity and profile information

**Fields**:
| Field | Type | Source | Required | Description |
|-------|------|--------|----------|-------------|
| `id` | string | Backend database (PostgreSQL) | Yes | Unique user identifier (UUID from backend) |
| `email` | string | Backend database | Yes | User's email address (displayed in navbar) |
| `profile` | ProfileObject | Backend database | No | User experience and interests (not used in navbar) |
| `profile.software_experience` | string | Backend database | No | Software skill level |
| `profile.hardware_experience` | string | Backend database | No | Hardware skill level |
| `profile.interests` | string[] | Backend database | No | List of interest topics |

**Validation Rules** (enforced by backend):
- Email must be valid format and unique
- ID is auto-generated by backend
- Profile fields optional during signup

**State Transitions**: N/A (read-only for navbar component)

**Navbar Usage**:
- **Email displayed**: When `user` is not null, `user.email` is rendered in navbar
- **Profile ignored**: Navbar does not display or use profile fields

---

### Session

**Source**: `src/lib/auth-client.ts:23-29`

**Purpose**: Represents authentication session state combining user data and tokens

**Fields**:
| Field | Type | Storage | Required | Description |
|-------|------|---------|----------|-------------|
| `user` | User \| null | React Context (AuthContext) | Yes | Current user or null if unauthenticated |
| `tokens` | TokensObject | LocalStorage | No | Access and refresh tokens for API calls |
| `tokens.access_token` | string | LocalStorage key: `access_token` | No | JWT access token (short-lived) |
| `tokens.refresh_token` | string | LocalStorage key: `refresh_token` | No | JWT refresh token (long-lived) |

**Validation Rules**:
- `user` null = unauthenticated state
- `user` non-null = authenticated state
- Tokens managed by auth-client.ts, not directly by navbar

**State Transitions**:
```
Unauthenticated (user = null, no tokens)
  â†“ [User logs in via signin/signup]
Authenticated (user = {id, email, ...}, tokens stored)
  â†“ [User clicks logout OR session expires]
Unauthenticated (user = null, tokens removed)
```

**Navbar Behavior Based on Session**:
| Session State | user value | Navbar Display |
|---------------|------------|----------------|
| Unauthenticated | null | Login button only |
| Authenticated | { id, email, ... } | Email + Logout button |
| Loading | null (but isLoading=true) | "Loading..." text |

---

## Component State (Local, Temporary)

### CustomLoginLogoutNavbarItem Component State

**Current State** (to be removed):
```typescript
const [isDropdownOpen, setIsDropdownOpen] = useState(false);  // REMOVE - dropdown not needed
const dropdownRef = useRef<HTMLDivElement>(null);            // REMOVE - dropdown not needed
```

**New State** (simplified):
```typescript
// No local state needed!
// All state comes from useAuth() hook:
// - user: User | null
// - isAuthenticated: boolean
// - isLoading: boolean
// - signout: () => Promise<void>
```

**Rationale**: Removing dropdown eliminates need for open/closed state management, simplifying component logic.

---

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend (FastAPI + PostgreSQL)                              â”‚
â”‚ - /api/v1/auth/signin â†’ Returns user + tokens               â”‚
â”‚ - /api/v1/auth/signout â†’ Invalidates refresh token          â”‚
â”‚ - /api/v1/profile â†’ Returns user profile                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“ HTTP requests (via auth-client.ts)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ auth-client.ts (src/lib/auth-client.ts)                     â”‚
â”‚ - authApi.signin() â†’ Stores tokens in localStorage          â”‚
â”‚ - authApi.signout() â†’ Removes tokens from localStorage      â”‚
â”‚ - authApi.getSession() â†’ Fetches profile, returns Session   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“ useSession(), useSignIn(), useSignOut() hooks
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AuthContext (src/components/auth/AuthContext.tsx)           â”‚
â”‚ - State: user (User | null)                                 â”‚
â”‚ - Derived: isAuthenticated = !!user                         â”‚
â”‚ - Methods: signin(), signup(), signout()                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“ useAuth() hook (consumed by navbar component)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CustomLoginLogoutNavbarItem                                 â”‚
â”‚ (src/theme/NavbarItem/CustomLoginLogoutNavbarItem.tsx)     â”‚
â”‚                                                              â”‚
â”‚ const { user, isAuthenticated, isLoading, signout } = useAuth()
â”‚                                                              â”‚
â”‚ Render Logic:                                               â”‚
â”‚   if (isLoading) â†’ "Loading..."                             â”‚
â”‚   if (isAuthenticated && user) â†’                            â”‚
â”‚      <span>{user.email}</span>                              â”‚
â”‚      <button onClick={signout}>Logout</button>              â”‚
â”‚   else â†’                                                     â”‚
â”‚      <a href="/auth/signin">Login</a>                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Validation Rules (for navbar component)

### Display Rules

| Condition | Display Requirement | Enforcement |
|-----------|---------------------|-------------|
| `isLoading === true` | Show "Loading..." | Component render logic |
| `isAuthenticated === true && user !== null` | Show email + logout button | Component render logic |
| `isAuthenticated === false && user === null` | Show Login button only | Component render logic |
| `user.email` present | Display email text in navbar | TypeScript type ensures email exists if user exists |

### Interaction Rules

| Action | Validation | Expected Behavior |
|--------|-----------|-------------------|
| Click Logout button | User must be authenticated (`isAuthenticated === true`) | Call `signout()`, clear session, redirect to `/` |
| Click Login button | User must be unauthenticated | Navigate to `/auth/signin` |
| Logout API fails | N/A (graceful degradation) | Still clear localStorage, update UI to unauthenticated |

---

## No Database Schema Changes

**Confirmation**: This feature requires **zero database changes**.

- No new tables
- No new columns
- No migrations
- No schema modifications

All data storage remains:
- **Backend**: PostgreSQL (users, sessions, profiles) - **unchanged**
- **Frontend**: LocalStorage (access_token, refresh_token) - **unchanged**
- **Runtime**: React Context (user state) - **unchanged**

---

## State Management Summary

### What Stays the Same
- âœ… Better Auth session management (authApi)
- âœ… AuthContext provider pattern
- âœ… LocalStorage token storage
- âœ… Backend authentication APIs
- âœ… User and Session data structures

### What Changes
- ğŸ”§ CustomLoginLogoutNavbarItem component **presentation logic only**
- ğŸ”§ Remove dropdown state management
- ğŸ”§ Simplified render logic (no toggle behavior)

### Data Integrity
- No risk of data corruption (read-only user display)
- No risk of token leakage (existing patterns maintained)
- No risk of session inconsistency (AuthContext remains source of truth)
